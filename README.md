# About this repository 

This repo has python scripts using ncclient to interact with Arista EOS devices

# About ncclient  

ncclient is a python library. It is a NETCONF client implementation in Python.    
Code https://github.com/ncclient/ncclient  
Doc https://ncclient.readthedocs.io/en/latest/  
PyPI (Python Package Index) https://pypi.python.org/pypi/ncclient  

# About NETCONF

NETCONF is a protocol defined in the [RFC 6241](https://tools.ietf.org/html/rfc6241)   
ncclient is a NETCONF client  

# Requirements 

Requirements on your laptop: 
```
pip freeze | grep ncclient
ncclient==0.6.7
```

Requirements on the EOS device: 
```
s7152#show running-config section netconf
management api netconf
   transport ssh def
```

# ncclient demo

```
>>> from ncclient import manager
>>> 
>>> eos=manager.connect(host="10.83.28.203", port="830", timeout=30, username="arista", password="arista", hostkey_verify=False)
>>> eos.connected
True
>>> eos.timeout
30
>>> eos.session_id
'872680990'
>>> 
>>> assert("urn:ietf:params:xml:ns:yang:ietf-netconf-monitoring" in eos.server_capabilities), "NetConf server not compliant with https://tools.ietf.org/html/rfc6022"
>>> 
>>> domain_name='''
... <system>
...     <config>
...         <domain-name>
...         </domain-name>
...     </config>
... </system>
... '''
>>> domain_name_conf = eos.get_config(source="running", filter=("subtree", domain_name))
>>> print (domain_name_conf)
<rpc-reply xmlns="urn:ietf:params:xml:ns:netconf:base:1.0" message-id="urn:uuid:e41791b2-72ef-41ce-9d2a-8d2286cbbfef"><data time-modified="2020-05-20T17:39:58.332197444Z"><system xmlns="http://openconfig.net/yang/system"><config><domain-name>lab.local</domain-name></config></system></data></rpc-reply>
>>> 
>>> eos.close_session()
<rpc-reply xmlns="urn:ietf:params:xml:ns:netconf:base:1.0" message-id="urn:uuid:bbc401ee-21ef-480e-947c-10d8d5f998b3"><ok></ok></rpc-reply>
>>> eos.connected
False
>>> 
>>> exit()
```

# How to open a NetConf session inside an SSH connection

we can invoke the NetConf subsystem using the following command:  
```
$ ssh admin@s7152 -s netconf
<hello xmlns="urn:ietf:params:xml:ns:netconf:base:1.0"><capabilities><capability>urn:ietf:params:netconf:base:1.0</capability><capability>urn:ietf:params:netconf:base:1.1</capability><capability>urn:ietf:params:xml:ns:netconf:base:1.0</capability><capability>urn:ietf:params:xml:ns:yang:ietf-netconf-monitoring</capability><capability>urn:ietf:params:netconf:capability:writable-running:1.0</capability><capability>http://arista.com/yang/openconfig/isis/augments?module=arista-isis-augments&amp;revision=2018-01-12</capability><capability>http://arista.com/yang/openconfig/acl/deviations?module=arista-acl-deviations&amp;revision=2019-06-17</capability><capability>http://openconfig.net/yang/rsvp?module=openconfig-mpls-rsvp&amp;revision=2018-11-21</capability><capability>http://arista.com/yang/openconfig/lldp/augments?module=arista-lldp-augments&amp;revision=2018-03-06</capability><capability>urn:ietf:params:xml:ns:netconf:base:1.0?module=ietf-netconf&amp;revision=2011-06-01</capability><capability>http://openconfig.net/yang/lldp/types?module=openconfig-lldp-types&amp;revision=2018-11-21</capability><capability>urn:ietf:params:xml:ns:yang:ietf-yang-types?module=ietf-yang-types&amp;revision=2013-07-15</capability><capability>http://openconfig.net/yang/pim?module=openconfig-pim&amp;revision=2018-11-21</capability><capability>http://openconfig.net/yang/bgp-policy?module=openconfig-bgp-policy&amp;revision=2018-11-21</capability><capability>http://arista.com/yang/openconfig/lldp/deviations?module=arista-lldp-deviations&amp;revision=2018-04-02</capability><capability>http://openconfig.net/yang/vlan-types?module=openconfig-vlan-types&amp;revision=2018-11-21</capability><capability>http://openconfig.net/yang/openconfig-ext?module=openconfig-extensions&amp;revision=2018-10-17</capability><capability>http://openconfig.net/yang/policy-forwarding?module=openconfig-policy-forwarding&amp;revision=2018-11-21</capability><capability>http://arista.com/yang/rpc/netconf?module=arista-rpc-netconf&amp;revision=2018-01-04</capability><capability>http://arista.com/yang/openconfig/pim/augments?module=arista-pim-augments&amp;revision=2019-04-24</capability><capability>urn:ietf:params:xml:ns:yang:ietf-inet-types?module=ietf-inet-types&amp;revision=2013-07-15</capability><capability>http://openconfig.net/yang/mpls-sr?module=openconfig-mpls-sr&amp;revision=2018-11-21</capability><capability>http://openconfig.net/yang/aaa/types?module=openconfig-aaa-types&amp;revision=2018-11-21</capability><capability>http://openconfig.net/yang/mpls?module=openconfig-mpls&amp;revision=2018-11-21</capability><capability>http://openconfig.net/yang/interfaces/aggregate?module=openconfig-if-aggregate&amp;revision=2018-11-21</capability><capability>http://arista.com/yang/openconfig/relay-agent/deviations?module=arista-relay-agent-deviations&amp;revision=2016-11-21</capability><capability>http://arista.com/yang/experimental/eos/qos/acl?module=arista-exp-eos-qos-acl-config&amp;revision=2018-11-13</capability><capability>http://openconfig.net/yang/system/logging?module=openconfig-system-logging&amp;revision=2018-11-21</capability><capability>http://arista.com/yang/openconfig/policy/deviations?module=arista-rpol-deviations&amp;revision=2016-02-01</capability><capability>http://arista.com/yang/experimental/eos/qos?module=arista-exp-eos-qos&amp;revision=2017-09-26</capability><capability>http://arista.com/yang/openconfig/mpls/augments?module=arista-mpls-augments&amp;revision=2017-12-21</capability><capability>http://openconfig.net/yang/igmp/types?module=openconfig-igmp-types&amp;revision=2018-11-21</capability><capability>http://openconfig.net/yang/pim/types?module=openconfig-pim-types&amp;revision=2018-11-21</capability><capability>http://openconfig.net/yang/interfaces/ip?module=openconfig-if-ip&amp;revision=2018-11-21</capability><capability>http://openconfig.net/yang/relay-agent?module=openconfig-relay-agent&amp;revision=2018-11-21</capability><capability>http://arista.com/yang/openconfig/lacp/deviations?module=arista-lacp-deviations&amp;revision=2017-09-07</capability><capability>http://openconfig.net/yang/platform/psu?module=openconfig-platform-psu&amp;revision=2018-11-21</capability><capability>http://openconfig.net/yang/hercules/interfaces?module=openconfig-hercules-interfaces&amp;revision=2018-06-01</capability><capability>http://openconfig.net/yang/types/yang?module=openconfig-yang-types&amp;revision=2018-11-21</capability><capability>http://arista.com/yang/experimental/eos/eos-types?module=arista-eos-types&amp;revision=2016-10-14</capability><capability>http://openconfig.net/yang/ospf-policy?module=openconfig-ospf-policy&amp;revision=2018-11-21</capability><capability>http://arista.com/yang/openconfig/interfaces/augments?module=arista-intf-augments&amp;revision=2019-01-20</capability><capability>http://openconfig.net/yang/sr?module=openconfig-segment-routing&amp;revision=2018-11-21</capability><capability>http://openconfig.net/yang/vlan?module=openconfig-vlan&amp;revision=2018-11-21</capability><capability>http://openconfig.net/yang/local-routing?module=openconfig-local-routing&amp;revision=2018-11-21</capability><capability>http://arista.com/yang/openconfig/network-instance/vlan/augments?module=arista-vlan-augments&amp;revision=2017-10-01</capability><capability>http://openconfig.net/yang/lldp?module=openconfig-lldp&amp;revision=2018-11-21</capability><capability>http://arista.com/yang/openconfig/network-instance/deviations?module=arista-vlan-deviations&amp;revision=2018-07-18</capability><capability>http://arista.com/yang/cert/gnoi-cert?module=arista-gnoi-cert&amp;revision=2018-01-15</capability><capability>http://arista.com/yang/experimental/eos/vxlan/config?module=arista-exp-eos-vxlan-config&amp;revision=2018-08-01</capability><capability>http://openconfig.net/yang/bgp-types?module=openconfig-bgp-types&amp;revision=2018-11-21</capability><capability>http://openconfig.net/yang/qos-types?module=openconfig-qos-types&amp;revision=2018-11-21</capability><capability>http://openconfig.net/yang/fib-types?module=openconfig-aft-types&amp;revision=2018-11-21</capability><capability>http://openconfig.net/yang/interfaces?module=openconfig-interfaces&amp;revision=2018-11-21</capability><capability>http://openconfig.net/yang/lacp?module=openconfig-lacp&amp;revision=2018-11-21</capability><capability>http://arista.com/yang/experimental/multicast?module=arista-exp-eos-multicast&amp;revision=2017-10-20</capability><capability>http://openconfig.net/yang/network-instance-l3?module=openconfig-network-instance-l3&amp;revision=2018-11-21</capability><capability>http://openconfig.net/yang/mpls-types?module=openconfig-mpls-types&amp;revision=2018-11-21</capability><capability>urn:ietf:params:xml:ns:yang:iana-if-type?module=iana-if-type&amp;revision=2017-01-19</capability><capability>http://openconfig.net/yang/platform-types?module=openconfig-platform-types&amp;revision=2018-11-21</capability><capability>http://arista.com/yang/openconfig/bgp/deviations?module=arista-bgp-deviations&amp;revision=2019-05-25</capability><capability>http://arista.com/yang/openconfig/system/augments?module=arista-system-augments&amp;revision=2018-06-03</capability><capability>http://arista.com/yang/openconfig/lacp/augments?module=arista-lacp-augments&amp;revision=2017-09-14</capability><capability>http://arista.com/yang/experimental/eos/qos/config?module=arista-exp-eos-qos-config&amp;revision=2017-09-26</capability><capability>http://openconfig.net/yang/types/inet?module=openconfig-inet-types&amp;revision=2018-11-21</capability><capability>http://arista.com/yang/experimental/eos?module=arista-exp-eos&amp;revision=2016-11-09</capability><capability>http://arista.com/yang/openconfig/bfd/augments?module=arista-bfd-augments&amp;revision=2019-01-14</capability><capability>http://openconfig.net/yang/routing-policy?module=openconfig-routing-policy&amp;revision=2018-11-21</capability><capability>http://arista.com/yang/experimental/eos/vxlan?module=arista-exp-eos-vxlan&amp;revision=2018-08-01</capability><capability>http://openconfig.net/yang/openconfig-isis?module=openconfig-isis&amp;revision=2018-11-21</capability><capability>http://openconfig.net/yang/network-instance?module=openconfig-network-instance&amp;revision=2018-11-21</capability><capability>http://openconfig.net/yang/acl?module=openconfig-acl&amp;revision=2018-11-21</capability><capability>http://openconfig.net/yang/qos?module=openconfig-qos&amp;revision=2018-11-21</capability><capability>urn:ietf:params:xml:ns:yang:ietf-interfaces?module=ietf-interfaces&amp;revision=2018-02-20</capability><capability>http://arista.com/yang/openconfig/polfwd/deviations?module=arista-srte-deviations&amp;revision=2019-01-03</capability><capability>http://openconfig.net/yang/ldp?module=openconfig-mpls-ldp&amp;revision=2018-11-21</capability><capability>http://arista.com/yang/openconfig/network-instances/deviations?module=arista-netinst-deviations&amp;revision=2019-05-24</capability><capability>http://openconfig.net/yang/platform?module=openconfig-platform&amp;revision=2018-11-21</capability><capability>http://openconfig.net/yang/alarms/types?module=openconfig-alarm-types&amp;revision=2018-11-21</capability><capability>http://openconfig.net/yang/system/management?module=openconfig-system-management&amp;revision=2018-11-21</capability><capability>http://openconfig.net/yang/system?module=openconfig-system&amp;revision=2018-11-21</capability><capability>http://openconfig.net/yang/aft?module=openconfig-aft&amp;revision=2018-11-21</capability><capability>http://arista.com/yang/openconfig/policy/augments?module=arista-rpol-augments&amp;revision=2018-04-12</capability><capability>http://openconfig.net/yang/policy-forwarding/sr-te?module=openconfig-pf-srte&amp;revision=2018-11-21</capability><capability>http://openconfig.net/yang/policy-types?module=openconfig-policy-types&amp;revision=2018-11-21</capability><capability>http://openconfig.net/yang/platform/fan?module=openconfig-platform-fan&amp;revision=2018-11-21</capability><capability>http://arista.com/yang/openconfig/mpls/deviations?module=arista-mpls-deviations&amp;revision=2018-03-19</capability><capability>http://openconfig.net/yang/aaa?module=openconfig-aaa&amp;revision=2018-11-21</capability><capability>http://openconfig.net/yang/isis-lsdb-types?module=openconfig-isis-lsdb-types&amp;revision=2018-11-21</capability><capability>http://openconfig.net/yang/system/procmon?module=openconfig-procmon&amp;revision=2018-11-21</capability><capability>http://openconfig.net/yang/interfaces/tunnel?module=openconfig-if-tunnel&amp;revision=2018-11-21</capability><capability>http://openconfig.net/yang/network-instance-types?module=openconfig-network-instance-types&amp;revision=2018-11-21</capability><capability>http://openconfig.net/yang/header-fields?module=openconfig-packet-match&amp;revision=2018-11-21</capability><capability>http://openconfig.net/yang/bgp?module=openconfig-bgp&amp;revision=2018-11-21</capability><capability>http://openconfig.net/yang/ospfv2?module=openconfig-ospfv2&amp;revision=2018-11-21</capability><capability>http://openconfig.net/yang/ospf-types?module=openconfig-ospf-types&amp;revision=2018-11-21</capability><capability>http://openconfig.net/yang/isis-types?module=openconfig-isis-types&amp;revision=2018-11-21</capability><capability>http://openconfig.net/yang/bfd?module=openconfig-bfd&amp;revision=2018-11-21</capability><capability>http://arista.com/yang/openconfig/bfd/deviations?module=arista-bfd-deviations&amp;revision=2018-08-08</capability><capability>http://arista.com/yang/openconfig/system/deviations?module=arista-system-deviations&amp;revision=2017-09-24</capability><capability>http://arista.com/yang/experimental/igmpsnooping?module=arista-exp-eos-igmpsnooping&amp;revision=2017-10-23</capability><capability>http://openconfig.net/yang/openconfig-types?module=openconfig-types&amp;revision=2018-11-21</capability><capability>http://openconfig.net/yang/system/terminal?module=openconfig-system-terminal&amp;revision=2018-11-21</capability><capability>urn:aristanetworks:yang:experimental:eos?module=arista-exp-eos-mlag&amp;revision=2017-11-29</capability><capability>http://openconfig.net/yang/platform/linecard?module=openconfig-platform-linecard&amp;revision=2018-11-21</capability><capability>http://arista.com/yang/openconfig/interfaces/deviations?module=arista-intf-deviations&amp;revision=2016-12-28</capability><capability>http://openconfig.net/yang/igmp?module=openconfig-igmp&amp;revision=2018-11-21</capability><capability>http://arista.com/yang/openconfig/isis/deviations?module=arista-isis-deviations&amp;revision=2019-05-14</capability><capability>http://arista.com/yang/experimental/eos/varp?module=arista-exp-eos-varp&amp;revision=2018-10-01</capability><capability>urn:ietf:params:xml:ns:yang:ietf-netconf-monitoring?module=ietf-netconf-monitoring&amp;revision=2010-10-04</capability><capability>http://openconfig.net/yang/packet-match-types?module=openconfig-packet-match-types&amp;revision=2018-11-21</capability><capability>http://openconfig.net/yang/interfaces/ethernet?module=openconfig-if-ethernet&amp;revision=2018-11-21</capability><capability>http://openconfig.net/yang/alarms?module=openconfig-alarms&amp;revision=2018-11-21</capability><capability>http://arista.com/yang/vlan-translation?module=vlan-translation&amp;revision=2017-11-29</capability><capability>http://arista.com/yang/openconfig/local-routing/deviations?module=arista-local-routing-deviations&amp;revision=2017-11-22</capability><capability>http://openconfig.net/yang/openconfig-if-types?module=openconfig-if-types&amp;revision=2018-11-21</capability><capability>http://openconfig.net/yang/ospfv2?module=openconfig-ospfv2-global&amp;revision=2018-11-21</capability><capability>http://openconfig.net/yang/aft?module=openconfig-aft-mpls&amp;revision=2018-11-21</capability><capability>http://openconfig.net/yang/mpls?module=openconfig-mpls-static&amp;revision=2018-11-21</capability><capability>http://openconfig.net/yang/aft?module=openconfig-aft-ipv4&amp;revision=2018-11-21</capability><capability>http://openconfig.net/yang/aft?module=openconfig-aft-common&amp;revision=2018-11-21</capability><capability>http://openconfig.net/yang/aft?module=openconfig-aft-pf&amp;revision=2018-11-21</capability><capability>http://openconfig.net/yang/qos?module=openconfig-qos-interfaces&amp;revision=2018-11-21</capability><capability>http://openconfig.net/yang/aft?module=openconfig-aft-ethernet&amp;revision=2018-11-21</capability><capability>http://openconfig.net/yang/aaa?module=openconfig-aaa-radius&amp;revision=2018-11-21</capability><capability>http://openconfig.net/yang/bgp?module=openconfig-bgp-common-structure&amp;revision=2018-11-21</capability><capability>http://openconfig.net/yang/mpls?module=openconfig-mpls-igp&amp;revision=2018-11-21</capability><capability>http://openconfig.net/yang/ospfv2?module=openconfig-ospfv2-area&amp;revision=2018-11-21</capability><capability>http://openconfig.net/yang/policy-forwarding?module=openconfig-pf-path-groups&amp;revision=2018-11-21</capability><capability>http://openconfig.net/yang/openconfig-isis?module=openconfig-isis-lsp&amp;revision=2018-11-21</capability><capability>http://openconfig.net/yang/openconfig-isis?module=openconfig-isis-routing&amp;revision=2018-11-21</capability><capability>http://openconfig.net/yang/aaa?module=openconfig-aaa-tacacs&amp;revision=2018-11-21</capability><capability>http://openconfig.net/yang/bgp?module=openconfig-bgp-common&amp;revision=2018-11-21</capability><capability>http://openconfig.net/yang/policy-forwarding?module=openconfig-pf-interfaces&amp;revision=2018-11-21</capability><capability>http://openconfig.net/yang/bgp?module=openconfig-bgp-peer-group&amp;revision=2018-11-21</capability><capability>http://openconfig.net/yang/bgp?module=openconfig-bgp-global&amp;revision=2018-11-21</capability><capability>http://openconfig.net/yang/ospfv2?module=openconfig-ospfv2-common&amp;revision=2018-11-21</capability><capability>http://openconfig.net/yang/ospfv2?module=openconfig-ospfv2-area-interface&amp;revision=2018-11-21</capability><capability>http://openconfig.net/yang/bgp-types?module=openconfig-bgp-errors&amp;revision=2018-11-21</capability><capability>http://openconfig.net/yang/qos?module=openconfig-qos-elements&amp;revision=2018-11-21</capability><capability>http://openconfig.net/yang/bgp?module=openconfig-bgp-neighbor&amp;revision=2018-11-21</capability><capability>http://openconfig.net/yang/policy-forwarding?module=openconfig-pf-forwarding-policies&amp;revision=2018-11-21</capability><capability>http://openconfig.net/yang/bgp?module=openconfig-bgp-common-multiprotocol&amp;revision=2018-11-21</capability><capability>http://openconfig.net/yang/ospfv2?module=openconfig-ospfv2-lsdb&amp;revision=2018-11-21</capability><capability>http://openconfig.net/yang/network-instance?module=openconfig-network-instance-l2&amp;revision=2018-11-21</capability><capability>http://openconfig.net/yang/aft?module=openconfig-aft-ipv6&amp;revision=2018-11-21</capability><capability>http://openconfig.net/yang/mpls?module=openconfig-mpls-te&amp;revision=2018-11-21</capability></capabilities><session-id>1549930933</session-id></hello>]]>]]>
```
The netconf server (eos device) advertised its capabilities. 
To close the NetConf session: 
```
<rpc><close-session></close-session></rpc>]]>]]>
```

# Credits

Thank you to for writing this blog https://eos.arista.com/ncclient-example-with-eos/  
It provided the basis for this example.

